<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BLACKOUT - SEGA Style Horror</title>
<style>
  body { margin:0; background:#000; overflow:hidden; font-family:'Courier New',monospace; color:#0f0; }
  #game { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); image-rendering:pixelated; box-shadow:0 0 40px #000; }
  #hud { position:absolute; top:8px; left:8px; font-size:14px; text-shadow:0 0 4px #000; pointer-events:none; }
  #msg { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:32px; color:#f00; background:rgba(0,0,0,0.6); opacity:0; transition:opacity 0.5s; pointer-events:none; }
</style>
</head>
<body>

<canvas id="game" width="320" height="224"></canvas>
<div id="hud">BREAKERS: <span id="count">0</span>/5</div>
<div id="msg"></div>

<script>
// ────────────────────────────────
// SEGA GENESIS STYLE SETUP
// ────────────────────────────────
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.style.width = '960px';  // ×3 upscale for modern screens
canvas.style.height = '672px';

const PAL = {
  bg: '#0c1428',
  floor: '#1c2c48',
  wallDark: '#102038',
  wallLight: '#24486c',
  breaker: '#ff8800',
  player: '#40e0d0',
  monster: '#8b0000',
  light: '#ffff88'
};

let cameraX = 0;
let player = { x: 80, y: 160, vx: 0, facing: 1 };
let monster = { x: -200, y: 160, active: false };
let breakers = [];
let activated = 0;
let gameOver = false;
let won = false;
let flashlight = false;

// Generate long hallway level
for (let i = 0; i < 40; i++) {
  // Occasional breaker placement
  if (i % 7 === 3 || i % 7 === 6) {
    breakers.push({ x: 200 + i * 180, y: 140, active: false });
  }
}

// Controls
const keys = {};
window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key === ' ') {
    flashlight = !flashlight;
    showMsg(flashlight ? 'FLASHLIGHT ON' : 'FLASHLIGHT OFF', '#0f0', 800);
  }
});
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// ────────────────────────────────
// GAME LOGIC
// ────────────────────────────────
function update() {
  if (gameOver || won) return;

  // Player movement (smooth Genesis-style run)
  player.vx = 0;
  if (keys['arrowleft'] || keys['a']) { player.vx = -2.8; player.facing = -1; }
  if (keys['arrowright'] || keys['d']) { player.vx = 2.8; player.facing = 1; }
  player.x += player.vx;

  // Camera follows player (with slight lead)
  if (player.vx > 0 && player.x > cameraX + 200) cameraX += (player.x - (cameraX + 200)) * 0.08;
  if (player.vx < 0 && player.x < cameraX + 80) cameraX += (player.x - (cameraX + 80)) * 0.08;

  // Monster chases slowly (faster if flashlight on)
  if (Math.abs(player.x - monster.x) < 600 || flashlight) monster.active = true;
  if (monster.active) {
    monster.x += (player.x > monster.x ? 1.1 : -1.1) * (flashlight ? 1.4 : 1);
  }

  // Breaker activation (press SPACE near one)
  if (keys[' ']) {
    breakers.forEach(b => {
      if (!b.active && Math.abs(b.x - player.x) < 40 && Math.abs(b.y - player.y) < 40) {
        b.active = true;
        activated++;
        document.getElementById('count').textContent = activated;
        showMsg('BREAKER ACTIVATED!', '#ffff00', 1200);
        if (activated >= 5) {
          won = true;
          showMsg('POWER ON!\nYOU ESCAPED THE SCHOOL', '#00ff00', 6000);
        }
      }
    });
  }

  // Monster catch
  if (Math.abs(monster.x - player.x) < 30 && Math.abs(monster.y - player.y) < 40) {
    gameOver = true;
    showMsg('CAUGHT BY THE SHADOW', '#ff0000', 9999);
  }
}

function showMsg(text, color, duration = 2000) {
  const msg = document.getElementById('msg');
  msg.textContent = text;
  msg.style.color = color;
  msg.style.opacity = 1;
  setTimeout(() => { msg.style.opacity = 0; }, duration);
}

// ────────────────────────────────
// RENDER (16-bit style)
// ────────────────────────────────
function render() {
  ctx.fillStyle = PAL.bg;
  ctx.fillRect(0, 0, 320, 224);

  // Parallax background (distant lockers/walls)
  ctx.fillStyle = PAL.wallDark;
  for (let i = -5; i < 15; i++) {
    let wx = (i * 140 - cameraX * 0.3) % 700 - 100;
    ctx.fillRect(wx, 80, 90, 100);
  }

  // Floor & near walls
  ctx.fillStyle = PAL.floor;
  ctx.fillRect(0, 180, 320, 44);

  ctx.fillStyle = PAL.wallLight;
  for (let i = -3; i < 20; i++) {
    let wx = (i * 220 - cameraX * 0.8) % 800 - 150;
    ctx.fillRect(wx, 100, 100, 100);
  }

  // Breakers
  breakers.forEach(b => {
    let sx = b.x - cameraX;
    if (sx > -60 && sx < 380) {
      ctx.fillStyle = b.active ? '#00ff88' : PAL.breaker;
      ctx.fillRect(sx - 12, b.y - 24, 24, 48);
      ctx.fillStyle = '#000';
      ctx.fillRect(sx - 6, b.y - 12, 12, 24);
    }
  });

  // Player (simple Genesis sprite feel)
  let px = player.x - cameraX;
  ctx.fillStyle = PAL.player;
  ctx.fillRect(px - 12, player.y - 40, 24, 48);  // body
  ctx.fillRect(px - 10, player.y - 52, 20, 20); // head
  ctx.fillStyle = '#000';
  ctx.fillRect(px - 4 + player.facing * 6, player.y - 46, 6, 6); // eye

  // Monster (only visible if close or flashlight)
  let mx = monster.x - cameraX;
  if (flashlight || Math.abs(mx - px) < 100 || monster.active) {
    ctx.fillStyle = PAL.monster;
    ctx.fillRect(mx - 18, monster.y - 50, 36, 60);
    ctx.fillStyle = '#ff4444';
    ctx.fillRect(mx - 10, monster.y - 38, 8, 10);
    ctx.fillRect(mx + 2, monster.y - 38, 8, 10);  // glowing eyes
  }

  // Flashlight beam (cone)
  if (flashlight) {
    ctx.globalAlpha = 0.25;
    ctx.fillStyle = PAL.light;
    ctx.beginPath();
    ctx.moveTo(px, player.y - 20);
    ctx.lineTo(px + player.facing * 180, player.y - 80);
    ctx.lineTo(px + player.facing * 180, player.y + 40);
    ctx.closePath();
    ctx.fill();
    ctx.globalAlpha = 1;
  }

  // CRT scanlines (optional retro filter)
  ctx.fillStyle = 'rgba(0,0,0,0.12)';
  for (let y = 0; y < 224; y += 4) {
    ctx.fillRect(0, y, 320, 2);
  }
}

function loop() {
  update();
  render();
  requestAnimationFrame(loop);
}

showMsg('RUN RIGHT →\nFind 5 breakers\nSPACE = Activate / Flashlight', '#0f0', 5000);
loop();
</script>

<h3 style="text-align:center; color:#0f0; margin:20px; font-family:Courier New;">
  Controls: ← → (or A D) to move   SPACE to toggle flashlight / pop breaker<br>
  Survive the dark school blackout, Elias — the shadow is always watching...
</h3>

</body>
</html>
