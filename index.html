<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Office Game</title>

<!--
====================================================
REQUIRED FILE STRUCTURE (DO NOT CHANGE NAMES)
====================================================

/index.html   <-- this file
/images/
  office.png
  player_normal.png
  player_gun.png
  player_attack.png
  npc.png
  monster.png
  giga_monster.png
  caught_screen.png

GitHub Pages is CASE-SENSITIVE.
"Npc.png" â‰  "npc.png"

====================================================
-->

<style>
  body { margin: 0; background: black; overflow: hidden; }
  canvas { display: block; margin: auto; background: black; }
</style>
</head>
<body>

<canvas id="game" width="640" height="480"></canvas>

<script>
/* ==================================================
   SETUP
================================================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const keys = {};
addEventListener("keydown", e => {
  keys[e.key.toLowerCase()] = true;
  if (["w","a","s","d"," "].includes(e.key.toLowerCase())) e.preventDefault();
});
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* ==================================================
   IMAGE LOADING (GITHUB-SAFE, NON-BLOCKING)
================================================== */
const images = {};
let loaded = 0;
const TOTAL_IMAGES = 8;

function loadImage(key, path) {
  const img = new Image();
  img.onload = () => {
    loaded++;
    console.log("Loaded:", path);
  };
  img.onerror = () => {
    console.error("FAILED TO LOAD:", path);
  };
  img.src = path;
  images[key] = img;
}

loadImage("office", "images/office.png");
loadImage("playerNormal", "images/player_normal.png");
loadImage("playerGun", "images/player_gun.png");
loadImage("playerAttack", "images/player_attack.png");
loadImage("npc", "images/npc.png");
loadImage("monster", "images/monster.png");
loadImage("giga", "images/giga_monster.png");
loadImage("caught", "images/caught_screen.png");

/* ==================================================
   GAME STATE
================================================== */
const GAME_PLAYING = 0;
const GAME_CAUGHT = 1;
let gameState = GAME_PLAYING;

/* ==================================================
   PLAYER
================================================== */
const player = {
  x: 100,
  y: 100,
  w: 24,
  h: 24,
  speed: 2,
  hasGun: false,
  attacking: false,
  cooldown: 0
};

/* ==================================================
   NPCs (20)
================================================== */
class NPC {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.alive = true;
  }
  draw() {
    if (this.alive && images.npc.complete) {
      ctx.drawImage(images.npc, this.x, this.y);
    }
  }
}

const npcs = [];
for (let i = 0; i < 20; i++) {
  npcs.push(new NPC(60 + i * 28, 380));
}

/* ==================================================
   MONSTERS
================================================== */
class Monster {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.alive = true;
  }
  draw() {
    if (this.alive && images.monster.complete) {
      ctx.drawImage(images.monster, this.x, this.y);
    }
  }
}

const monsters = [
  new Monster(420, 200),
  new Monster(460, 200)
];

/* ==================================================
   GIGA MONSTER (SPAWNS AFTER 2 MINUTES)
================================================== */
class GigaMonster {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.hits = 2;
    this.speed = 0.6;
    this.alive = true;
  }
  chase() {
    const dx = player.x - this.x;
    const dy = player.y - this.y;
    const d = Math.hypot(dx, dy);
    if (d) {
      this.x += (dx / d) * this.speed;
      this.y += (dy / d) * this.speed;
    }
  }
  draw() {
    if (this.alive && images.giga.complete) {
      ctx.drawImage(images.giga, this.x, this.y);
    }
  }
}

let giga = null;
const gameStartTime = performance.now();

/* ==================================================
   MAIN LOOP
================================================== */
function update(time) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* LOADING SCREEN */
  if (loaded < TOTAL_IMAGES) {
    ctx.fillStyle = "white";
    ctx.font = "20px monospace";
    ctx.fillText("Loading images...", 220, 220);
    ctx.fillText(`${loaded} / ${TOTAL_IMAGES}`, 280, 250);
    requestAnimationFrame(update);
    return;
  }

  ctx.drawImage(images.office, 0, 0);

  if (gameState === GAME_PLAYING) {

    let dx = 0, dy = 0;
    if (keys.w) dy -= player.speed;
    if (keys.s) dy += player.speed;
    if (keys.a) dx -= player.speed;
    if (keys.d) dx += player.speed;

    player.x += dx;
    player.y += dy;

    player.hasGun = keys["1"];
    player.attacking = player.hasGun && keys[" "];

    if (player.attacking && player.cooldown <= 0) {
      player.cooldown = 20;

      monsters.forEach(m => {
        if (m.alive && Math.hypot(m.x - player.x, m.y - player.y) < 40) {
          m.alive = false;
        }
      });

      if (giga && giga.alive &&
          Math.hypot(giga.x - player.x, giga.y - player.y) < 40) {
        giga.hits--;
        if (giga.hits <= 0) giga.alive = false;
      }
    }

    if (player.cooldown > 0) player.cooldown--;

    if (!giga && time - gameStartTime >= 120000) {
      giga = new GigaMonster(520, 120);
      console.log("GIGA MONSTER SPAWNED");
    }

    if (giga && giga.alive) {
      giga.chase();
      if (Math.hypot(giga.x - player.x, giga.y - player.y) < 16) {
        gameState = GAME_CAUGHT;
      }
    }

    const sprite =
      player.attacking ? images.playerAttack :
      player.hasGun ? images.playerGun :
      images.playerNormal;

    ctx.drawImage(sprite, player.x, player.y);

    npcs.forEach(n => n.draw());
    monsters.forEach(m => m.draw());
    if (giga) giga.draw();

  } else {
    ctx.drawImage(images.caught, 0, 0);
  }

  requestAnimationFrame(update);
}

/* ==================================================
   START GAME
================================================== */
requestAnimationFrame(update);
</script>

</body>
</html>
