<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DROPZONE PROTOCOL</title>
<style>
  html, body { margin:0; overflow:hidden; background:#000; font-family:monospace; color:#0f0; height:100%; }
  canvas { image-rendering:pixelated; display:block; }
  #ui { position:fixed; inset:0; pointer-events:none; }
  #hub { position:absolute; top:0; left:0; right:0; background:#1118; backdrop-filter:blur(4px); border-bottom:2px solid #0f08; padding:8px 16px; display:flex; justify-content:center; gap:20px; pointer-events:auto; z-index:20; }
  #hub button { background:#222; color:#0f0; border:2px solid #0f08; padding:8px 16px; font-size:14px; cursor:pointer; transition:0.2s; }
  #hub button:hover { background:#333; border-color:#0f0; }
  #hub button.active { background:#0f08; color:#000; }
  .tab { position:absolute; inset:0; padding:80px 20px 20px; display:none; pointer-events:auto; overflow-y:auto; text-align:center; }
  .tab.active { display:block; }
  .panel { background:#1118; border:2px solid #0f08; padding:20px; max-width:600px; margin:0 auto 20px; border-radius:4px; }
  select, input { background:#222; color:#0f0; border:1px solid #0f08; padding:8px; width:200px; margin:8px; font-family:monospace; }
  .preview { width:200px; height:300px; margin:20px auto; border:2px solid #0f0; background:#0004; position:relative; }
  .shop-item { display:inline-block; margin:15px; text-align:center; width:180px; }
  .shop-item button { margin-top:8px; width:100%; }
  .locked { opacity:0.5; pointer-events:none; }
  #game-canvas { position:absolute; inset:0; z-index:5; }
  #hud { position:absolute; top:50px; left:20px; color:#0f0; text-shadow:0 0 4px #000; font-size:16px; pointer-events:none; z-index:10; }
</style>
</head>
<body>
<div id="ui">
  <div id="hub">
    <button data-tab="play" class="active">PLAY</button>
    <button data-tab="shop">SHOP</button>
    <button data-tab="character">CHARACTER</button>
    <button data-tab="news">NEWS</button>
  </div>

  <div id="play" class="tab active">
    <div class="panel">
      <h2>Ready for Dropzone?</h2>
      <div id="play-preview" class="preview"></div>
      <p>Weapon: <span id="play-weapon">Assault Rifle</span></p>
      <button onclick="startGame()">START MISSION</button>
    </div>
  </div>

  <div id="shop" class="tab">
    <div class="panel">
      <h2>ARMORY - Credits: <span id="credits">5000</span></h2>
      <p>Buy futuristic weaponry to dominate the battlefield.</p>
      <div id="shop-items"></div>
    </div>
  </div>

  <div id="character" class="tab">
    <div class="panel">
      <h2>CHARACTER CUSTOMIZER</h2>
      <div id="char-preview" class="preview"></div>
      <label>Skin Tone</label>
      <select id="skin">
        <option value="#ffdbac">Light</option>
        <option value="#e0ac69">Medium</option>
        <option value="#c68642">Tan</option>
        <option value="#8b4513">Bronze</option>
      </select><br>
      <label>Outfit Color</label>
      <select id="outfit">
        <option value="#4a5d23">Marine</option>
        <option value="#2a4365">Navy</option>
        <option value="#78281f">Crimson</option>
        <option value="#1f2937">Shadow</option>
      </select><br>
      <label>Headgear</label>
      <select id="hat">
        <option value="none">None</option>
        <option value="helmet">Combat Helmet</option>
        <option value="cap">Boonie Hat</option>
        <option value="beret">Beret</option>
      </select><br>
      <button onclick="saveCustomization()">SAVE & RETURN</button>
    </div>
  </div>

  <div id="news" class="tab">
    <div class="panel">
      <h2>NEWS & STATUS</h2>
      <p style="font-size:18px; color:#ff0;">THIS IS A BETA</p>
      <p>WORK IN PROGRESS â€” SORRY!</p>
      <ul style="text-align:left; max-width:500px; margin:20px auto;">
        <li>Core gameplay loop complete</li>
        <li>Organic character & enemy models</li>
        <li>Hub + shop system added</li>
        <li>More weapons, maps, enemies coming soon</li>
        <li>Sound? Multiplayer? Who knows...</li>
      </ul>
    </div>
  </div>

  <div id="hud" class="hidden">
    <!-- Existing HUD elements -->
    <div id="hp"></div>
    <div id="weapon"></div>
    <div id="kills"></div>
    <div id="timer"></div>
    <div id="shiphp" class="hidden"></div>
  </div>

  <div id="success" class="hidden panel" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:15;">
    <h2>MISSION SUCCESS</h2>
    <p>Extraction Complete</p>
    <button onclick="location.reload()">RETURN TO HUB</button>
  </div>
</div>

<canvas id="c" class="hidden"></canvas>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Persistent data
let credits = parseInt(localStorage.getItem('dp_credits')) || 5000;
let ownedWeapons = JSON.parse(localStorage.getItem('dp_owned')) || ['rifle'];
let playerCustom = JSON.parse(localStorage.getItem('dp_custom')) || {
  skin: '#ffdbac', outfit: '#4a5d23', hat: 'none'
};
let selectedWeapon = localStorage.getItem('dp_weapon') || 'rifle';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Shop weapons (futuristic sci-fi flavored)
const shopWeapons = {
  plasma_pistol:    { name: 'Plasma Pistol',     price: 800,  desc: 'Rapid energy bolts, low recoil', iconColor: '#00ffff' },
  ion_rifle:        { name: 'Ion Assault Rifle', price: 1800, desc: 'High-rate burst fire, shield-piercing', iconColor: '#00ff88' },
  rail_sniper:      { name: 'Rail Sniper',       price: 3200, desc: 'One-shot kill at range, slow reload', iconColor: '#ffffff' },
  vortex_cannon:    { name: 'Vortex Cannon',     price: 4500, desc: 'Pulls enemies in before exploding', iconColor: '#ff00ff' },
  arc_blade:        { name: 'Arc Energy Blade',  price: 2800, desc: 'Melee chain lightning, high DPS close', iconColor: '#ffff00' },
  neutron_minigun:  { name: 'Neutron Minigun',   price: 6000, desc: 'Spins up to insane fire rate', iconColor: '#ff8800' }
};

// Update credits display
function updateCredits() {
  document.getElementById('credits').innerText = credits;
  localStorage.setItem('dp_credits', credits);
}

// Populate shop
function populateShop() {
  const container = document.getElementById('shop-items');
  container.innerHTML = '';
  Object.keys(shopWeapons).forEach(key => {
    const w = shopWeapons[key];
    const owned = ownedWeapons.includes(key);
    const div = document.createElement('div');
    div.className = 'shop-item';
    div.innerHTML = `
      <div style="width:120px;height:80px;margin:0 auto;background:#0004;border:1px solid ${w.iconColor};position:relative;">
        <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:${w.iconColor};font-size:40px;opacity:0.7;">${key.includes('blade')?'âš”':'ðŸ”«'}</div>
      </div>
      <strong>${w.name}</strong><br>
      ${w.desc}<br>
      <em>Price: ${w.price} credits</em><br>
      ${owned ? '<span style="color:#0f0;">OWNED</span>' : `<button ${credits < w.price ? 'disabled' : ''} onclick="buyWeapon('${key}',${w.price})">BUY</button>`}
    `;
    if (!owned && credits < w.price) div.querySelector('button')?.classList.add('locked');
    container.appendChild(div);
  });
  updateCredits();
}

function buyWeapon(key, price) {
  if (credits >= price) {
    credits -= price;
    ownedWeapons.push(key);
    localStorage.setItem('dp_owned', JSON.stringify(ownedWeapons));
    localStorage.setItem('dp_weapon', key); // auto-equip on buy
    selectedWeapon = key;
    alert(`Purchased ${shopWeapons[key].name}! Equipped.`);
    populateShop();
    updatePlayPreview();
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Character preview (simple canvas preview for hub)
function drawPreview(canvasId, weaponKey = selectedWeapon) {
  const cv = document.getElementById(canvasId);
  if (!cv) return;
  cv.width = 200; cv.height = 300;
  const pctx = cv.getContext('2d');
  pctx.clearRect(0,0,200,300);
  pctx.translate(100, 150);

  // Body
  pctx.fillStyle = playerCustom.outfit;
  pctx.beginPath();
  pctx.ellipse(0, 20, 30, 50, 0, 0, Math.PI*2);
  pctx.fill();

  // Head
  pctx.fillStyle = playerCustom.skin;
  pctx.beginPath();
  pctx.arc(0, -40, 25, 0, Math.PI*2);
  pctx.fill();

  // Hat / helmet stub
  if (playerCustom.hat !== 'none') {
    pctx.fillStyle = '#555';
    pctx.fillRect(-28, -65, 56, 20);
  }

  // Weapon icon
  pctx.fillStyle = '#888';
  pctx.fillRect(20, -10, 60, 20);
  pctx.fillStyle = '#0f0';
  pctx.fillText(weaponKey.slice(0,8).toUpperCase(), 25, 5);
}

function updatePlayPreview() {
  document.getElementById('play-weapon').innerText = shopWeapons[selectedWeapon]?.name || selectedWeapon;
  drawPreview('play-preview');
}

function saveCustomization() {
  playerCustom.skin = document.getElementById('skin').value;
  playerCustom.outfit = document.getElementById('outfit').value;
  playerCustom.hat = document.getElementById('hat').value;
  localStorage.setItem('dp_custom', JSON.stringify(playerCustom));
  alert('Customization saved!');
  switchTab('play');
}

// Tab switching
function switchTab(tabId) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  document.querySelectorAll('#hub button').forEach(b => b.classList.remove('active'));
  document.querySelector(`#hub button[data-tab="${tabId}"]`).classList.add('active');

  if (tabId === 'shop') populateShop();
  if (tabId === 'play' || tabId === 'character') {
    drawPreview(tabId === 'play' ? 'play-preview' : 'char-preview');
  }
}

// Hub buttons
document.querySelectorAll('#hub button').forEach(btn => {
  btn.onclick = () => switchTab(btn.dataset.tab);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Game start / canvas logic (your existing game code here)
// For brevity, paste your full game script from previous versions inside startGame()
// Make sure to hide hub + show canvas/hud on start, and show success/hub on end

function startGame() {
  // Hide hub, show canvas & hud
  document.getElementById('hub').style.display = 'none';
  document.getElementById('c').classList.remove('hidden');
  document.getElementById('hud').classList.remove('hidden');
  // ... paste your full game init/update/draw/loop here ...
  // On mission success/fail â†’ location.reload() or custom return to hub
}

// Init
updatePlayPreview();
drawPreview('char-preview');
populateShop();
</script>
</body>
</html>
