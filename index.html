<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Smash Game</title>
<style>
  body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    background: #222;
    border: 2px solid white;
  }
</style>
</head>
<body>

<canvas id="game" width="800" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

const gravity = 0.6;
const friction = 0.8;

/* =====================
   PLATFORM
===================== */
const platforms = [
  { x: 200, y: 350, w: 400, h: 20 },
  { x: 100, y: 250, w: 150, h: 15 },
  { x: 550, y: 250, w: 150, h: 15 }
];

/* =====================
   PLAYER
===================== */
function Fighter(x, color) {
  return {
    x, y: 50,
    w: 30, h: 40,
    vx: 0, vy: 0,
    onGround: false,
    percent: 0,
    color,
    facing: 1
  };
}

const player = Fighter(300, "#4af");
const enemy  = Fighter(500, "#f44");

/* =====================
   COLLISION
===================== */
function rectsCollide(a, b) {
  return (
    a.x < b.x + b.w &&
    a.x + a.w > b.x &&
    a.y < b.y + b.h &&
    a.y + a.h > b.y
  );
}

/* =====================
   ATTACK
===================== */
function attack(attacker, target) {
  const hitbox = {
    x: attacker.x + attacker.facing * attacker.w,
    y: attacker.y + 10,
    w: 20,
    h: 20
  };

  if (rectsCollide(hitbox, target)) {
    target.percent += 8;
    target.vx = attacker.facing * (4 + target.percent * 0.05);
    target.vy = -5;
  }
}

/* =====================
   UPDATE
===================== */
function updateFighter(f, controls) {
  if (controls) {
    if (keys.a) { f.vx = -4; f.facing = -1; }
    if (keys.d) { f.vx =  4; f.facing =  1; }
    if (keys.w && f.onGround) {
      f.vy = -12;
      f.onGround = false;
    }
    if (keys[" "]) attack(f, enemy);
  }

  f.vy += gravity;
  f.x += f.vx;
  f.y += f.vy;
  f.vx *= friction;

  f.onGround = false;
  platforms.forEach(p => {
    if (rectsCollide(f, p) && f.vy >= 0) {
      f.y = p.y - f.h;
      f.vy = 0;
      f.onGround = true;
    }
  });

  // Ring out
  if (f.y > canvas.height + 200) {
    f.x = Math.random() * 400 + 200;
    f.y = 0;
    f.percent = 0;
    f.vx = f.vy = 0;
  }
}

/* =====================
   ENEMY AI
===================== */
function enemyAI() {
  if (enemy.x < player.x - 10) { enemy.vx = 2; enemy.facing = 1; }
  if (enemy.x > player.x + 10) { enemy.vx = -2; enemy.facing = -1; }
  if (Math.random() < 0.01 && enemy.onGround) enemy.vy = -10;
  if (Math.abs(enemy.x - player.x) < 50) attack(enemy, player);
}

/* =====================
   DRAW
===================== */
function drawFighter(f) {
  ctx.fillStyle = f.color;
  ctx.fillRect(f.x, f.y, f.w, f.h);
  ctx.fillStyle = "white";
  ctx.fillText(Math.floor(f.percent) + "%", f.x, f.y - 5);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#555";
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

  drawFighter(player);
  drawFighter(enemy);
}

/* =====================
   LOOP
===================== */
function loop() {
  updateFighter(player, true);
  enemyAI();
  updateFighter(enemy, false);
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
