<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Kamen Rider Smash</title>
<style>
  body {
    margin: 0;
    background: #000;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    background: #111;
    border: 2px solid white;
  }
</style>
</head>
<body>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* =====================
   GAME STATES
===================== */
const SELECT = 0;
const PLAY = 1;
let gameState = SELECT;

/* =====================
   CHARACTERS
===================== */
const characters = [
  { name: "WIZARD", color: "#c33", speed: 4, power: 8 },
  { name: "GHOST", color: "#ddd", speed: 5, power: 6 },
  { name: "GAIM", color: "#fa3", speed: 4, power: 7 },
  { name: "DRIVE", color: "#f00", speed: 6, power: 5 },
  { name: "OOO", color: "#ff0", speed: 4, power: 8 },
  { name: "DOUBLE", color: "#0f0", speed: 4, power: 7 },
  { name: "REVI", color: "#4af", speed: 5, power: 6 },
  { name: "VICE", color: "#a4f", speed: 5, power: 6 }
];

let selected = 0;

/* =====================
   FIGHTER
===================== */
function Fighter(x, char) {
  return {
    x, y: 100,
    w: 40, h: 50,
    vx: 0, vy: 0,
    onGround: false,
    percent: 0,
    facing: 1,
    char
  };
}

let player, enemy;

/* =====================
   PLATFORM
===================== */
const platforms = [
  { x: 200, y: 380, w: 500, h: 20 },
  { x: 100, y: 280, w: 180, h: 15 },
  { x: 620, y: 280, w: 180, h: 15 }
];

const gravity = 0.6;

/* =====================
   COLLISION
===================== */
function hit(a, b) {
  return (
    a.x < b.x + b.w &&
    a.x + a.w > b.x &&
    a.y < b.y + b.h &&
    a.y + a.h > b.y
  );
}

/* =====================
   ATTACK
===================== */
function attack(attacker, target) {
  const box = {
    x: attacker.x + attacker.facing * attacker.w,
    y: attacker.y + 15,
    w: 25,
    h: 20
  };
  if (hit(box, target)) {
    target.percent += attacker.char.power;
    target.vx = attacker.facing * (4 + target.percent * 0.04);
    target.vy = -6;
  }
}

/* =====================
   UPDATE FIGHTER
===================== */
function updateFighter(f, control) {
  if (control) {
    if (keys.a) { f.vx = -f.char.speed; f.facing = -1; }
    if (keys.d) { f.vx =  f.char.speed; f.facing = 1; }
    if (keys.w && f.onGround) {
      f.vy = -12;
      f.onGround = false;
    }
    if (keys[" "]) attack(f, enemy);
  }

  f.vy += gravity;
  f.x += f.vx;
  f.y += f.vy;
  f.vx *= 0.8;

  f.onGround = false;
  platforms.forEach(p => {
    if (hit(f, p) && f.vy >= 0) {
      f.y = p.y - f.h;
      f.vy = 0;
      f.onGround = true;
    }
  });

  if (f.y > canvas.height + 200) {
    f.y = 0;
    f.x = Math.random() * 400 + 200;
    f.percent = 0;
    f.vx = f.vy = 0;
  }
}

/* =====================
   ENEMY AI
===================== */
function enemyAI() {
  if (enemy.x < player.x) enemy.vx = 2;
  if (enemy.x > player.x) enemy.vx = -2;
  if (Math.random() < 0.01 && enemy.onGround) enemy.vy = -11;
  if (Math.abs(enemy.x - player.x) < 50) attack(enemy, player);
}

/* =====================
   DRAW
===================== */
function drawFighter(f) {
  ctx.fillStyle = f.char.color;
  ctx.fillRect(f.x, f.y, f.w, f.h);
  ctx.fillStyle = "black";
  ctx.fillText(f.char.name[0], f.x + 14, f.y + 32);
  ctx.fillStyle = "white";
  ctx.fillText(Math.floor(f.percent) + "%", f.x, f.y - 5);
}

/* =====================
   SELECT SCREEN
===================== */
function drawSelect() {
  ctx.fillStyle = "white";
  ctx.font = "30px monospace";
  ctx.fillText("CHARACTER SELECT", 280, 80);

  characters.forEach((c, i) => {
    ctx.fillStyle = i === selected ? "yellow" : "white";
    ctx.fillText(c.name, 350, 140 + i * 35);
  });

  ctx.font = "18px monospace";
  ctx.fillText("Press E to change character", 300, 430);
  ctx.fillText("Press ENTER to start", 330, 460);
}

/* =====================
   INPUT
===================== */
addEventListener("keydown", e => {
  if (gameState === SELECT) {
    if (e.key.toLowerCase() === "e") {
      selected = (selected + 1) % characters.length;
    }
    if (e.key === "Enter") {
      player = Fighter(300, characters[selected]);
      enemy = Fighter(520, characters[Math.floor(Math.random() * characters.length)]);
      gameState = PLAY;
    }
  }
});

/* =====================
   LOOP
===================== */
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameState === SELECT) {
    drawSelect();
  } else {
    platforms.forEach(p => {
      ctx.fillStyle = "#555";
      ctx.fillRect(p.x, p.y, p.w, p.h);
    });
    updateFighter(player, true);
    enemyAI();
    updateFighter(enemy, false);
    drawFighter(player);
    drawFighter(enemy);
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
