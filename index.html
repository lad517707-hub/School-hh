<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cuphead-Style Game (WASD Controls)</title>
<style>
body {
  margin: 0;
  background: #1b1b1b;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
canvas {
  background: #2a2a2a;
  border: 4px solid #f5f5f5;
}
</style>
</head>
<body>

<canvas id="game" width="800" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* =====================
   INPUT
===================== */
const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* =====================
   PLAYER
===================== */
const player = {
  x: 100,
  y: 300,
  w: 30,
  h: 40,
  vx: 0,
  vy: 0,
  speed: 4,
  facing: 1,
  onGround: false,
  dashTimer: 0,
  hp: 3,
  super: 0
};

const gravity = 0.6;
const groundY = 360;

/* =====================
   BULLETS
===================== */
const bullets = [];
function shoot() {
  bullets.push({
    x: player.x + (player.facing > 0 ? player.w : 0),
    y: player.y + 18,
    vx: player.facing * 8
  });
}

/* =====================
   BOSS
===================== */
const boss = {
  x: 560,
  y: 260,
  w: 120,
  h: 120,
  hp: 300,
  timer: 0
};

const bossBullets = [];

/* =====================
   COLLISION
===================== */
function hit(a,b){
  return a.x < b.x+b.w && a.x+a.w > b.x &&
         a.y < b.y+b.h && a.y+a.h > b.y;
}

/* =====================
   UPDATE
===================== */
function update() {

  // Move
  if (keys.a) {
    player.vx = -player.speed;
    player.facing = -1;
  } else if (keys.d) {
    player.vx = player.speed;
    player.facing = 1;
  } else {
    player.vx *= 0.8;
  }

  // Jump
  if (keys.w && player.onGround) {
    player.vy = -12;
    player.onGround = false;
  }

  // Dash
  if (keys.shift && player.dashTimer <= 0) {
    player.vx = player.facing * 12;
    player.dashTimer = 20;
  }
  if (player.dashTimer > 0) player.dashTimer--;

  // Shoot
  if (keys.r && Math.random() < 0.3) shoot();

  // Super
  if (keys.q && player.super >= 100) {
    for (let i = 0; i < 20; i++) {
      bullets.push({
        x: player.x + player.w / 2,
        y: player.y + 20,
        vx: Math.random() * 10 - 5
      });
    }
    player.super = 0;
  }

  // Physics
  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  if (player.y + player.h >= groundY) {
    player.y = groundY - player.h;
    player.vy = 0;
    player.onGround = true;
  }

  // Player bullets
  bullets.forEach(b => b.x += b.vx);
  for (let i = bullets.length - 1; i >= 0; i--) {
    if (hit({x:bullets[i].x,y:bullets[i].y,w:6,h:6}, boss)) {
      boss.hp--;
      player.super = Math.min(100, player.super + 1);
      bullets.splice(i,1);
    }
  }

  // Boss behavior
  boss.timer++;
  if (boss.timer % 60 === 0) {
    bossBullets.push({
      x: boss.x,
      y: boss.y + 60,
      vx: -5,
      vy: Math.random() * 4 - 2
    });
  }

  bossBullets.forEach(b => {
    b.x += b.vx;
    b.y += b.vy;
    if (hit({x:b.x,y:b.y,w:10,h:10}, player)) {
      player.hp--;
      b.x = -999;
    }
  });
}

/* =====================
   DRAW
===================== */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ground
  ctx.fillStyle = "#444";
  ctx.fillRect(0, groundY, canvas.width, 10);

  // Player
  ctx.fillStyle = "white";
  ctx.fillRect(player.x, player.y, player.w, player.h);
  ctx.fillStyle = "black";
  ctx.fillRect(player.x + (player.facing > 0 ? 18 : 6), player.y + 10, 6, 6);

  // Boss
  ctx.fillStyle = "#b22222";
  ctx.beginPath();
  ctx.arc(boss.x + 60, boss.y + 60, 60, 0, Math.PI * 2);
  ctx.fill();

  // Bullets
  ctx.fillStyle = "yellow";
  bullets.forEach(b => ctx.fillRect(b.x, b.y, 6, 6));

  ctx.fillStyle = "pink";
  bossBullets.forEach(b => ctx.fillRect(b.x, b.y, 10, 10));

  // UI
  ctx.fillStyle = "white";
  ctx.fillText("HP: " + player.hp, 20, 20);
  ctx.fillText("SUPER", 20, 40);
  ctx.fillRect(80, 32, player.super, 6);
}

/* =====================
   LOOP
===================== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
