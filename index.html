<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Game - Death Screen Fixed</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #111;
            color: #eee;
            text-align: center;
        }
        #creation, #game, #death { display: none; }
        button {
            background: #4a6;
            color: white;
            border: none;
            padding: 12px 28px;
            margin: 12px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 6px;
        }
        button:hover { background: #6c8; }
        select, input {
            padding: 10px;
            font-size: 16px;
            margin: 8px;
            background: #222;
            color: white;
            border: 2px solid #666;
        }
        .pixel-model {
            width: 120px;
            height: 160px;
            margin: 20px auto;
            background: #444;
            border: 4px solid #888;
            position: relative;
        }
        .head { width: 50px; height: 50px; background: #ffd; border-radius: 50%; position: absolute; top: 10px; left: 35px; }
        .body { width: 60px; height: 80px; background: #555; position: absolute; top: 55px; left: 30px; border-radius: 15px; }
        .health-bar {
            width: 200px;
            height: 24px;
            background: #333;
            border: 3px solid #555;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
        }
        .health-fill {
            height: 100%;
            background: #4caf50;
            width: 100%;
            transition: width 0.4s;
        }
        .health-text {
            position: absolute;
            inset: 0;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #death {
            position: fixed;
            inset: 0;
            background: black;
            color: #f44;
            font-size: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #dm-text {
            font-size: 18px;
            line-height: 1.5;
            margin: 30px auto;
            padding: 20px;
            background: #1a1a1a;
            border: 2px solid #444;
            max-width: 700px;
        }
    </style>
</head>
<body>

<div id="creation">
    <h1>D&D Adventure</h1>
    <label>Race:</label><br>
    <select id="race">
        <option value="human">Human</option>
        <option value="elf">Elf</option>
        <option value="dwarf">Dwarf</option>
    </select><br><br>

    <label>Class:</label><br>
    <select id="class">
        <option value="fighter">Fighter</option>
        <option value="wizard">Wizard</option>
        <option value="rogue">Rogue</option>
    </select><br><br>

    <label>Weapons:</label><br>
    <input type="text" id="weapons" value="Sword"><br><br>

    <button onclick="startGame()">Start Game</button>
</div>

<div id="game">
    <h1>Your Adventure</h1>

    <div class="pixel-model">
        <div class="head"></div>
        <div class="body"></div>
    </div>

    <div class="health-bar">
        <div class="health-fill" id="hp-fill"></div>
        <div class="health-text" id="hp-text">HP: 20 / 20</div>
    </div>

    <div id="dm-text">DM: Welcome, Elias. Your journey begins...</div>

    <div id="actions">
        <button onclick="startFight()">Fight</button>
        <button onclick="rest()">Rest</button>
    </div>
</div>

<div id="death">
    You have fallen...<br>Rise up
    <br><br>
    <button onclick="location.reload()" style="font-size:28px; padding:20px 50px;">Restart</button>
</div>

<script>
let currentHP = 25;
let maxHP = 25;

function startGame() {
    const cls = document.getElementById("class").value;

    // Force positive HP
    maxHP = 20 + (cls === "fighter" ? 12 : 8);
    currentHP = maxHP;

    console.log("Game started â†’ HP:", currentHP, "/", maxHP);

    document.getElementById("creation").style.display = "none";
    document.getElementById("game").style.display = "block";
    document.getElementById("death").style.display = "none";

    updateHP();
    document.getElementById("dm-text").textContent = "DM: You stand ready, " + cls + ". What now?";
}

function updateHP() {
    if (currentHP < 1) currentHP = 1; // safety net
    const percent = (currentHP / maxHP) * 100;
    document.getElementById("hp-fill").style.width = percent + "%";
    document.getElementById("hp-text").textContent = `HP: ${currentHP} / ${maxHP}`;
    console.log("HP updated to:", currentHP, percent + "%");
}

function startFight() {
    document.getElementById("dm-text").textContent = "DM: A goblin attacks!";
    document.getElementById("actions").innerHTML = `
        <button onclick="playerAttack()">Attack</button>
        <button onclick="takeDamage(5)">Take sample damage (test)</button>
    `;
}

function playerAttack() {
    const roll = Math.floor(Math.random() * 20) + 1;
    document.getElementById("dm-text").textContent = `You roll ${roll}! ${roll >= 10 ? "Hit!" : "Miss!"}`;
}

function takeDamage(amount) {
    currentHP -= amount;
    if (currentHP <= 0) {
        currentHP = 0;
        document.getElementById("game").style.display = "none";
        document.getElementById("death").style.display = "flex";
    } else {
        updateHP();
        document.getElementById("dm-text").textContent = `You take ${amount} damage. HP now ${currentHP}/${maxHP}`;
    }
}

function rest() {
    currentHP = Math.min(maxHP, currentHP + 8);
    updateHP();
    document.getElementById("dm-text").textContent = "DM: You rest and recover. HP now " + currentHP + "/" + maxHP;
}
</script>
</body>
</html>
