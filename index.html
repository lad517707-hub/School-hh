<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FALLOUT MINI</title>
<style>
  body {
    margin:0;
    background:#000;
    overflow:hidden;
    font-family:'Courier New', Courier, monospace;
    color:#0f0;
  }
  #game {
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    image-rendering:pixelated;
    box-shadow:0 0 40px #000;
  }
  #hud {
    position:absolute;
    top:8px;
    left:8px;
    font-size:14px;
    text-shadow:0 0 5px #000;
    pointer-events:none;
    color:#00ff88;
    z-index:10;
  }
  #msg {
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:28px;
    color:#f00;
    background:rgba(0,0,0,0.75);
    opacity:0;
    transition:opacity 0.6s;
    pointer-events:none;
    font-weight:bold;
    text-shadow:0 0 10px #f00;
    z-index:20;
  }
  #pipboy {
    position:absolute;
    inset:0;
    background:#001100;
    color:#00ff44;
    display:none;
    flex-direction:column;
    padding:24px;
    box-sizing:border-box;
    z-index:30;
    border:4px solid #008833;
    box-shadow:inset 0 0 60px #003300;
    font-size:15px;
  }
  #pipboy h2 {
    margin:0 0 16px;
    text-align:center;
    color:#88ff88;
    text-shadow:0 0 8px #00ff00;
  }
  .pip-section {
    margin:14px 0;
    border-bottom:1px dashed #004400;
    padding-bottom:10px;
  }
  .label { color:#55ff55; font-weight:bold; }
  .value  { color:#aaffaa; }
  #pipmap {
    width:200px;
    height:146px;
    background:#000811;
    border:2px solid #00aa33;
    image-rendering:pixelated;
    margin:12px auto;
    display:block;
  }
</style>
</head>
<body>

<canvas id="game" width="320" height="224"></canvas>
<div id="hud">
  CELLS: <span id="cells">0</span>/5 │ HP: <span id="hp">100</span> │ AMMO: <span id="ammo">20</span> │ <span id="quest">Escape Vault 101</span>
</div>
<div id="msg"></div>

<div id="pipboy">
  <h2>PIP-BOY 2000 Mk VI</h2>
  <div class="pip-section">
    <div><span class="label">STATUS</span> <span id="p_hp">100</span>/100 HP</div>
    <div><span class="label">AMMO</span> <span id="p_ammo">20</span> × 10mm</div>
    <div><span class="label">CELLS</span> <span id="p_cells">0</span>/5</div>
    <div><span class="label">QUEST</span> <span id="p_quest">Find 5 fusion cells</span></div>
  </div>
  <div class="pip-section">
    <div><span class="label">LOCATION</span> Vault 101 – Sublevel C</div>
    <div><span class="label">RADS</span> 0 / 200</div>
  </div>
  <canvas id="pipmap" width="200" height="146"></canvas>
  <div style="text-align:center; margin-top:24px; color:#44ff44; font-size:14px;">
    TAB to close Pip-Boy
  </div>
</div>

<script>
// FALLOUT MINI – simple top-down vault crawler
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.style.width  = '960px';
canvas.style.height = '672px';

const TILE = 16;
const MAP_W = 25;
const MAP_H = 18;

const PAL = {
  bg: '#0a0a00',
  floor: '#2a1a08',
  wall: '#4a2a10',
  vaultWall: '#3a3a5a',
  vaultFloor: '#1f1f2f',
  cellOff: '#ff8800',
  cellOn:  '#00ff88',
  player: '#30c0c0',
  playerDark: '#107070',
  mutant: '#1a6c1a',
  raider: '#8b4513',
  ghoul:  '#4c5b1f',
  bullet: '#ffff99',
  door:   '#8b4513'
};

let player = { x:2.5, y:2.5, hp:100, ammo:20, facing:0 }; // 0=down 1=right 2=up 3=left
let enemies = [];
let cells   = [];
let bullets = [];
let collected = 0;
let gameOver  = false;
let levelWon  = false;
let pipOpen   = false;
let map = [];

const stories = [
  "Vault 101 – power critical. Find 5 fusion cells to open the door.",
  "Cell acquired. Something growls in the dark…",
  "Structural failure imminent. Move fast.",
  "Raider ahead. 'Nice pip-boy, vault boy… hand it over.'",
  "All cells in. Vault door opening. Good luck out there."
];

function generateLevel() {
  map = Array(MAP_H).fill().map(()=>Array(MAP_W).fill('#'));

  // rooms
  for(let i=0; i<7; i++){
    let rx=3+~~(Math.random()*(MAP_W-10));
    let ry=3+~~(Math.random()*(MAP_H-10));
    let rw=5+~~(Math.random()*6);
    let rh=4+~~(Math.random()*6);
    for(let y=ry; y<ry+rh && y<MAP_H; y++)
      for(let x=rx; x<rx+rw && x<MAP_W; x++)
        map[y][x] = '.';
  }

  // corridors
  for(let y=1;y<MAP_H-1;y++)
    for(let x=1;x<MAP_W-1;x++)
      if(Math.random()<0.09) map[y][x]='.';

  cells = [];
  enemies = [];
  bullets = [];

  // cells
  for(let i=0;i<5;i++){
    let x,y;
    do{x=~~(Math.random()*MAP_W); y=~~(Math.random()*MAP_H);}while(map[y][x]!=='.');
    cells.push({x:x+0.5,y:y+0.5,active:false});
  }

  // enemies
  for(let i=0;i<6;i++){
    let x,y;
    do{x=~~(Math.random()*MAP_W); y=~~(Math.random()*MAP_H);}while(map[y][x]!=='.' || Math.hypot(x+0.5-2.5,y+0.5-2.5)<5);
    let t = Math.random()<0.6?'ghoul':'raider';
    enemies.push({x:x+0.5,y:y+0.5,type:t,hp:t==='ghoul'?40:55});
  }

  player.x=2.5; player.y=2.5;
  collected=0;
  gameOver=levelWon=false;
  updateHUD();
  showStory(0);
}

function updateHUD(){
  document.getElementById('cells').textContent = collected;
  document.getElementById('hp').textContent   = player.hp;
  document.getElementById('ammo').textContent = player.ammo;
  updatePipBoy();
}

function showMsg(txt, col='#0f0', dur=1400){
  const m = document.getElementById('msg');
  m.textContent = txt;
  m.style.color = col;
  m.style.opacity = 1;
  setTimeout(()=>m.style.opacity=0, dur);
}

function showStory(idx){
  showMsg(stories[idx] || stories[0], '#88ff88', 4000);
}

function updatePipBoy(){
  document.getElementById('p_hp').textContent    = player.hp;
  document.getElementById('p_ammo').textContent  = player.ammo;
  document.getElementById('p_cells').textContent = collected;
  document.getElementById('p_quest').textContent = collected<5 ? "Find 5 fusion cells" : "Exit the vault";

  // mini map
  const pm = document.getElementById('pipmap').getContext('2d');
  pm.fillStyle = '#000811';
  pm.fillRect(0,0,200,146);
  for(let y=0;y<MAP_H;y++)for(let x=0;x<MAP_W;x++){
    pm.fillStyle = map[y][x]==='#' ? '#222244' : '#0a2211';
    pm.fillRect(x*8, y*8, 8, 8);
  }
  pm.fillStyle = '#00ff88';
  pm.fillRect(player.x*8-5, player.y*8-5, 12, 12);
}

const keys = {};
window.addEventListener('keydown', e=>{
  const k = e.key.toLowerCase();
  if (k==='tab') {
    e.preventDefault();
    pipOpen = !pipOpen;
    document.getElementById('pipboy').style.display = pipOpen?'flex':'none';
  }
  keys[k] = true;
  if (k==='e') tryCollect();
  if (k==='f' && !e.repeat) tryShoot();
});
window.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

function tryCollect(){
  for(let c of cells){
    if(!c.active && Math.hypot(c.x-player.x, c.y-player.y)<1.4){
      c.active = true;
      collected++;
      showMsg("FUSION CELL ACQUIRED","#00ff88");
      updateHUD();
      if(collected>=5){
        levelWon = true;
        showMsg("VAULT DOOR OPENING…","#88ff88",5000);
      }
      return;
    }
  }
}

function tryShoot(){
  if(player.ammo<=0){ showMsg("CLICK – no ammo","#ff8800"); return; }
  player.ammo--;
  updateHUD();

  const dirs = [Math.PI/2, 0, -Math.PI/2, Math.PI]; // down right up left
  bullets.push({
    x:player.x, y:player.y,
    vx:Math.cos(dirs[player.facing])*0.45,
    vy:Math.sin(dirs[player.facing])*0.45,
    life:50
  });
}

function isWalkable(x,y){
  const tx=~~x, ty=~~y;
  return tx>=0 && tx<MAP_W && ty>=0 && ty<MAP_H && map[ty][tx]!=='#';
}

function update(){
  if(gameOver || levelWon || pipOpen) return;

  // ─── MOVEMENT ─────────────────────────────────────
  let dx=0, dy=0;
  if(keys['w'] || keys['arrowup'   ]) { dy -= 0.12; player.facing = 2; }
  if(keys['s'] || keys['arrowdown' ]) { dy += 0.12; player.facing = 0; }
  if(keys['a'] || keys['arrowleft' ]) { dx -= 0.12; player.facing = 3; }
  if(keys['d'] || keys['arrowright']) { dx += 0.12; player.facing = 1; }

  if(dx !== 0 && dy !== 0){ dx *= 0.707; dy *= 0.707; }

  let nx = player.x + dx;
  let ny = player.y + dy;

  if(isWalkable(nx, player.y)) player.x = nx;
  if(isWalkable(player.x, ny)) player.y = ny;
  // ──────────────────────────────────────────────────

  // bullets
  bullets = bullets.filter(b=>{
    b.x += b.vx; b.y += b.vy; b.life--;
    if(b.life<=0 || !isWalkable(b.x,b.y)) return false;
    for(let e of enemies){
      if(e.hp>0 && Math.hypot(e.x-b.x, e.y-b.y)<0.8){
        e.hp -= 35;
        if(e.hp<=0) showMsg(e.type.toUpperCase()+" KILLED","#ff4444");
        return false;
      }
    }
    return true;
  });

  // enemies chase + contact damage
  enemies.forEach(e=>{
    if(e.hp<=0) return;
    let dist = Math.hypot(e.x-player.x, e.y-player.y);
    if(dist < 6.5){
      let ang = Math.atan2(player.y-e.y, player.x-e.x);
      let nx = e.x + Math.cos(ang)*0.075;
      let ny = e.y + Math.sin(ang)*0.075;
      if(isWalkable(nx,e.y)) e.x = nx;
      if(isWalkable(e.x,ny)) e.y = ny;
    }
    if(dist < 1.2){
      player.hp -= 10;
      document.getElementById('hp').textContent = Math.max(0,player.hp);
      showMsg("HIT! -10 HP","#ff4444",600);
      if(player.hp<=0){
        gameOver=true;
        showMsg("YOU DIED","#f00",9999);
      }
    }
  });
}

let camx, camy;

function render(){
  ctx.fillStyle = PAL.bg;
  ctx.fillRect(0,0,320,224);

  camx = player.x * TILE - 160;
  camy = player.y * TILE - 112;

  // map tiles
  for(let y=0;y<MAP_H;y++)for(let x=0;x<MAP_W;x++){
    let sx = x*TILE - camx;
    let sy = y*TILE - camy;
    if(sx>-TILE && sx<340 && sy>-TILE && sy<250){
      ctx.fillStyle = map[y][x]==='#' ? PAL.vaultWall : PAL.vaultFloor;
      ctx.fillRect(sx,sy,TILE,TILE);
    }
  }

  // cells
  cells.forEach(c=>{
    let sx = c.x*TILE - camx;
    let sy = c.y*TILE - camy;
    ctx.fillStyle = c.active ? PAL.cellOn : PAL.cellOff;
    ctx.fillRect(sx-6,sy-6,12,12);
  });

  // enemies
  enemies.forEach(e=>{
    if(e.hp<=0) return;
    let sx = e.x*TILE - camx;
    let sy = e.y*TILE - camy;
    ctx.fillStyle = e.type==='ghoul'?PAL.ghoul:PAL.raider;
    ctx.fillRect(sx-8,sy-16,16,26);
  });

  // bullets
  bullets.forEach(b=>{
    let sx = b.x*TILE - camx;
    let sy = b.y*TILE - camy;
    ctx.fillStyle = PAL.bullet;
    ctx.fillRect(sx-3,sy-3,6,6);
  });

  // player
  let px = player.x*TILE - camx;
  let py = player.y*TILE - camy;
  ctx.fillStyle = PAL.player;
  ctx.fillRect(px-7,py-16,14,22);
  ctx.fillStyle = PAL.playerDark;
  ctx.fillRect(px-9,py-14,5,12);
  ctx.fillRect(px+4,py-14,5,12);
  ctx.fillStyle = '#d0d080';
  ctx.fillRect(px-5,py-22,10,10);

  // simple vignette / darkness
  let grad = ctx.createRadialGradient(160,112,0,160,112,180);
  grad.addColorStop(0,'rgba(0,0,0,0)');
  grad.addColorStop(0.7,'rgba(0,0,0,0.85)');
  grad.addColorStop(1,'rgba(0,0,0,0.98)');
  ctx.fillStyle = grad;
  ctx.fillRect(0,0,320,224);
}

function loop(){
  update();
  render();
  requestAnimationFrame(loop);
}

generateLevel();
loop();

setTimeout(()=>{
  showMsg("WASD / arrows = move   E = collect cell   F = shoot   TAB = pip-boy", "#88ffcc", 7000);
}, 1200);
</script>

<h3 style="text-align:center; color:#0f0; margin:20px; font-family:Courier New;">
  FALLOUT MINI – Elias Edition<br>
  WASD / Arrows = Move • E = Collect Cell • F = Shoot • TAB = Pip-Boy
</h3>

</body>
</html>
