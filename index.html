<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DROPZONE PROTOCOL</title>
<style>
html,body{margin:0;overflow:hidden;background:#000;font-family:monospace}
canvas{image-rendering:pixelated;display:block}
#ui{position:fixed;inset:0;color:white}
.panel{background:#111;border:1px solid #555;padding:12px;max-width:320px}
button,input{background:#222;color:#fff;border:1px solid #555;padding:6px;margin-top:6px}
.hidden{display:none}
</style>
</head>
<body>

<div id="ui">
  <div id="menu" class="panel">
    <h2>DROPZONE PROTOCOL</h2>
    <label>Username</label><br>
    <input id="username" value="Marine"><br>

    <label>Starting Weapon</label><br>
    <select id="startWeapon">
      <option value="rifle">Rifle</option>
      <option value="hammer">Power Hammer</option>
      <option value="rotary">Rotary Cannon</option>
      <option value="blade">Ark Blade</option>
    </select><br>

    <button onclick="startGame()">Single Player</button>
    <button onclick="openMultiplayer()">Multiplayer</button>
  </div>

  <div id="multiplayer" class="panel hidden">
    <h3>Multiplayer (Groundwork)</h3>
    <input placeholder="Party Name"><br>
    <input placeholder="Party Code"><br>
    <button onclick="startGame()">Create / Join</button>
    <button onclick="closeMultiplayer()">Back</button>
  </div>

  <div id="hud" class="hidden">
    <div id="hp"></div>
    <div id="weapon"></div>
    <div id="timer"></div>
  </div>

  <div id="success" class="panel hidden">
    <h2>MISSION SUCCESS</h2>
    <p>Extraction complete.</p>
    <button onclick="location.reload()">Return</button>
  </div>
</div>

<canvas id="c"></canvas>

<script>
/* ===== SETUP ===== */
const c=document.getElementById("c"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();addEventListener("resize",resize);

/* ===== MAP ===== */
const biomes=[
 {ground:"#c2b280",water:"#8ad"},
 {ground:"#1f3b2d",water:"#3a6"},
 {ground:"#223",water:"#446"},
 {ground:"#333",water:"#111"},
 {ground:"#2a4",water:"#48a"}
];
const map=biomes[Math.random()*biomes.length|0];

/* ===== INPUT ===== */
const keys={},mouse={x:0,y:0,down:false};
onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;
onmousemove=e=>{mouse.x=e.clientX;mouse.y=e.clientY};
onmousedown=()=>mouse.down=true;
onmouseup=()=>mouse.down=false;

/* ===== GAME STATE ===== */
let game=false,over=false,shake=0;
let extraction=300; // seconds
let ship=null;

/* ===== PLAYER ===== */
const player={
 x:0,y:0,hp:100,max:100,
 angle:0,weapon:"rifle",
 kills:0,bladeMult:1,
 name:""
};

/* ===== ENTITIES ===== */
const enemies=[],bullets=[],blood=[];

/* ===== UI ===== */
function openMultiplayer(){
 menu.classList.add("hidden");
 multiplayer.classList.remove("hidden");
}
function closeMultiplayer(){
 multiplayer.classList.add("hidden");
 menu.classList.remove("hidden");
}

/* ===== START ===== */
function startGame(){
 player.name=username.value;
 player.weapon=startWeapon.value;
 menu.classList.add("hidden");
 multiplayer.classList.add("hidden");
 hud.classList.remove("hidden");
 game=true;
}

/* ===== SPAWN ===== */
function spawnEnemy(){
 enemies.push({
  x:player.x+(Math.random()-0.5)*800,
  y:player.y+(Math.random()-0.5)*800,
  hp:60,max:60,
  frame:0
 });
}

/* ===== SHOOT ===== */
function fire(){
 shake=8;
 bullets.push({
  x:player.x,y:player.y,
  dx:Math.cos(player.angle),
  dy:Math.sin(player.angle),
  life:40
 });
}

/* ===== UPDATE ===== */
function update(){
 if(!game||over)return;

 if(keys.w)player.y-=3;
 if(keys.s)player.y+=3;
 if(keys.a)player.x-=3;
 if(keys.d)player.x+=3;

 player.angle=Math.atan2(mouse.y-c.height/2,mouse.x-c.width/2);

 if(mouse.down){
  if(player.weapon==="rifle")fire();
 }

 bullets.forEach(b=>{
  b.x+=b.dx*10;b.y+=b.dy*10;b.life--;
  enemies.forEach(e=>{
   if(Math.hypot(b.x-e.x,b.y-e.y)<14){
    e.hp-=12;b.life=0;
    blood.push({x:e.x,y:e.y,life:20});
   }
  });
 });

 for(let i=bullets.length-1;i>=0;i--)
  if(bullets[i].life<=0)bullets.splice(i,1);

 enemies.forEach(e=>{
  let dx=player.x-e.x,dy=player.y-e.y,d=Math.hypot(dx,dy);
  e.x+=dx/d*1.2;e.y+=dy/d*1.2;
  if(d<20)player.hp-=0.4;
 });

 for(let i=enemies.length-1;i>=0;i--){
  if(enemies[i].hp<=0){
   player.kills++;
   enemies.splice(i,1);
  }
 }

 blood.forEach(b=>b.life--);
 for(let i=blood.length-1;i>=0;i--)
  if(blood[i].life<=0)blood.splice(i,1);

 if(Math.random()<0.03)spawnEnemy();

 extraction-=1/60;
 if(extraction<=0&&!ship)
  ship={x:player.x+300,y:player.y+300,hp:1000};

 if(player.hp<=0){
  over=true;
  alert("MISSION FAILED");
  location.reload();
 }
}

/* ===== DRAW ===== */
function draw(){
 ctx.setTransform(1,0,0,1,0,0);
 ctx.clearRect(0,0,c.width,c.height);

 let sx=(Math.random()-0.5)*shake;
 let sy=(Math.random()-0.5)*shake;
 shake*=0.8;

 ctx.translate(c.width/2-player.x+sx,c.height/2-player.y+sy);

 ctx.fillStyle=map.ground;
 ctx.fillRect(player.x-2000,player.y-2000,4000,4000);

 ctx.fillStyle=map.water;
 for(let i=0;i<20;i++)
  ctx.fillRect(i*200-800,i*120-600,60,40);

 enemies.forEach(e=>{
  e.frame=(e.frame+1)%20;
  ctx.fillStyle="#3f3";
  ctx.fillRect(e.x-8,e.y-8,16,16);
  ctx.fillStyle="#f00";
  ctx.fillRect(e.x-10,e.y-14,20*(e.hp/e.max),3);
 });

 ctx.fillStyle="#7f0";
 blood.forEach(b=>ctx.fillRect(b.x,b.y,3,3));

 bullets.forEach(b=>{
  ctx.fillStyle="#ff0";
  ctx.fillRect(b.x,b.y,4,2);
 });

 ctx.save();
 ctx.translate(player.x,player.y);
 ctx.rotate(player.angle);
 ctx.fillStyle="#ccc";
 ctx.fillRect(-6,-6,12,12);
 ctx.fillRect(6,-2,10,4);
 ctx.restore();

 if(ship){
  ctx.fillStyle="#888";
  ctx.fillRect(ship.x-20,ship.y-20,40,40);

  const dx=ship.x-player.x,dy=ship.y-player.y;
  const a=Math.atan2(dy,dx);
  ctx.save();
  ctx.translate(player.x,player.y);
  ctx.rotate(a);
  ctx.fillStyle="#0af";
  ctx.fillRect(20,-2,12,4);
  ctx.restore();

  if(Math.hypot(dx,dy)<30){
   success.classList.remove("hidden");
   game=false;
  }
 }

 ctx.setTransform(1,0,0,1,0,0);

 hp.innerText=`HP: ${player.hp|0}`;
 weapon.innerText=`Weapon: ${player.weapon}`;
 timer.innerText=`Extraction: ${extraction|0}s`;
}

/* ===== LOOP ===== */
function loop(){update();draw();requestAnimationFrame(loop)}
loop();
</script>
</body>
</html>
