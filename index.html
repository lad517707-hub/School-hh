<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Masked Fighters Arena</title>
<style>
body {
  margin: 0;
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
canvas {
  background: #111;
  border: 2px solid white;
}
</style>
</head>
<body>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const keys = {};
addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* =====================
   GAME STATE
===================== */
const SELECT = 0, PLAY = 1;
let state = SELECT;

/* =====================
   CHARACTERS
===================== */
const roster = [
  { name:"WIZARD", color:"#c33", speed:4, power:8 },
  { name:"GHOST", color:"#ddd", speed:5, power:6 },
  { name:"GAIM", color:"#fa3", speed:4, power:7 },
  { name:"DRIVE", color:"#f00", speed:6, power:5 },
  { name:"OOO", color:"#ff0", speed:4, power:8 },
  { name:"DOUBLE", color:"#0f0", speed:4, power:7 },
  { name:"REVI", color:"#4af", speed:5, power:6 },
  { name:"VICE", color:"#a4f", speed:5, power:6 }
];

let selected = 0;

/* =====================
   FIGHTER
===================== */
function Fighter(x, char, controls) {
  return {
    x, y: 80,
    vx: 0, vy: 0,
    w: 28, h: 54,
    facing: 1,
    onGround: false,
    percent: 0,
    meter: 0,
    state: "idle",
    char,
    controls
  };
}

let p1, p2;

/* =====================
   PLATFORMS
===================== */
const platforms = [
  {x:200,y:380,w:500,h:20},
  {x:120,y:280,w:180,h:15},
  {x:600,y:280,w:180,h:15}
];

const gravity = 0.6;

/* =====================
   FIREBALL ULTIMATE
===================== */
const fireballs = [];

function spawnFireball(owner, target) {
  fireballs.push({
    x: owner.x + owner.facing * 30,
    y: owner.y + 20,
    r: 18,
    target,
    life: 240
  });
}

/* =====================
   COLLISION
===================== */
function hit(a,b){
  return a.x < b.x+b.w && a.x+a.w > b.x &&
         a.y < b.y+b.h && a.y+a.h > b.y;
}

/* =====================
   ATTACK
===================== */
function attack(attacker, target, strength){
  const box = {
    x: attacker.x + attacker.facing * attacker.w,
    y: attacker.y + 18,
    w: 26,
    h: 22
  };
  if(hit(box,target)){
    target.percent += strength;
    target.vx = attacker.facing * (4 + target.percent * 0.04);
    target.vy = -6;
    attacker.meter = Math.min(100, attacker.meter + 15);
  }
}

/* =====================
   UPDATE FIGHTER
===================== */
function updateFighter(f, enemy){
  const c = f.controls;

  if(keys[c.left]){ f.vx=-f.char.speed; f.facing=-1; f.state="walk"; }
  else if(keys[c.right]){ f.vx=f.char.speed; f.facing=1; f.state="walk"; }
  else f.state="idle";

  if(keys[c.jump] && f.onGround){
    f.vy=-12;
    f.onGround=false;
  }

  if(keys[c.punch]){ f.state="punch"; attack(f,enemy,f.char.power); }
  if(keys[c.kick]){ f.state="kick"; attack(f,enemy,f.char.power+2); }

  if(keys[c.ultimate] && f.meter>=100){
    spawnFireball(f,enemy);
    f.meter=0;
  }

  f.vy+=gravity;
  f.x+=f.vx;
  f.y+=f.vy;
  f.vx*=0.8;

  f.onGround=false;
  platforms.forEach(p=>{
    if(hit(f,p)&&f.vy>=0){
      f.y=p.y-f.h;
      f.vy=0;
      f.onGround=true;
    }
  });

  if(f.y>canvas.height+200){
    f.x=300+Math.random()*200;
    f.y=0;
    f.percent=0;
    f.
