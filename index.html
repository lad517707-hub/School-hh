<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Shift Horror - 10 Nights</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  body, html { margin:0; padding:0; overflow:hidden; background:#000; font-family:'Courier New', monospace; color:#0f0; }
  canvas { display:block; }
  #ui {
    position:absolute; inset:0; pointer-events:none; color:#0f0; text-shadow:0 0 8px #0f0; font-size:1.4rem; padding:20px; z-index:10;
  }
  #phone {
    position:absolute; bottom:40px; left:50%; transform:translateX(-50%);
    width:360px; height:720px; background:#0a001a; border:6px solid #330066; border-radius:36px;
    padding:30px; box-shadow:0 0 60px #330066; display:none; pointer-events:all; overflow-y:auto; font-size:1.2rem; line-height:1.6; z-index:20;
  }
  #phone.show { display:block; }
  #time { position:absolute; top:20px; right:30px; font-size:3rem; text-shadow:0 0 12px #ff00aa; }
  #hud { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); font-size:2rem; text-shadow:0 0 10px #00ffff; }
  #shift-message {
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    font-size:5rem; text-align:center; color:#ff0040; text-shadow:0 0 20px #ff0040; display:none; z-index:30;
  }
  #end-shift {
    position:absolute; inset:0; background:rgba(0,0,0,0.95); color:#ff0040; font-size:6rem; text-align:center; padding-top:40vh; display:none; z-index:30;
  }
</style>
</head>
<body>

<div id="ui">
  <div id="time">04:00</div>
  <div id="hud"></div>
</div>

<div id="phone">
  <h2>Phone</h2>
  <div id="mission-text"></div>
</div>

<div id="shift-message"></div>
<div id="end-shift">YOUR SHIFT IS OVER<br>GO HOME</div>

<canvas id="c"></canvas>

<script>
// =============== SETUP ===============
const c = document.getElementById('c');
const ctx = c.getContext('2d');
c.width = window.innerWidth;
c.height = window.innerHeight;

let shift = parseInt(localStorage.getItem('currentShift') || '1');
let timeLeft = 240;
let gameState = 'shift';
let playerX = 0, playerY = 0, playerAngle = 0;
let pistolEquipped = false;
let crouching = false;
let childrenQueue = [];
let rooms = Array(18).fill(0);

const missions = [
  "",
  "Get all the children into their corresponding Class room",
  "get all the children into their corresponding class room...",
  "children in classroom",
  "classroom",
  "children",
  "I see you...",
  "",
  "I know who you are...and i'm not afraid...",
  "aoidhfa;fhoapdifhvnaosd;pfui",
  "In a next life, i'll be waiting"
];

function updateMissionText() {
  document.getElementById('mission-text').innerHTML = `<strong>Night ${shift} Mission:</strong><br><br>${missions[shift]}`;
}
updateMissionText();

// =============== INPUT ===============
const keys = {};
window.addEventListener('keydown', e => {
  keys[e.key.toLowerCase()] = true;
  if (e.key === 'Shift') {
    document.getElementById('phone').classList.toggle('show');
  }
});
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// =============== RAYCASTING 3D ===============
const fov = Math.PI / 3;
const rayCount = 240;

const map = [
  [1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,0,1,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,1,0,1,0,1,0,1,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1]
];

function castRay(angle) {
  let x = playerX, y = playerY;
  let dist = 0;
  while (dist < 20) {
    x += Math.cos(angle) * 0.1;
    y += Math.sin(angle) * 0.1;
    dist += 0.1;
    const mx = Math.floor(x), my = Math.floor(y);
    if (mx < 0 || mx >= map[0].length || my < 0 || my >= map.length) return {dist: 20, hit: false};
    if (map[my][mx] === 1) return {dist, hit: true};
  }
  return {dist: 20, hit: false};
}

function render() {
  ctx.fillStyle = '#110022';
  ctx.fillRect(0,0,c.width,c.height);

  // Ceiling & floor
  ctx.fillStyle = '#220044';
  ctx.fillRect(0, 0, c.width, c.height/2);
  ctx.fillStyle = '#001122';
  ctx.fillRect(0, c.height/2, c.width, c.height/2);

  for (let i = 0; i < rayCount; i++) {
    const rayAngle = playerAngle - fov/2 + (i / rayCount) * fov;
    const {dist, hit} = castRay(rayAngle);
    const height = c.height / dist * 80;
    const shade = Math.max(0.2, 1 - dist/15);
    ctx.fillStyle = hit ? `rgba(0,80,160,${shade})` : '#001122';
    ctx.fillRect(i * (c.width/rayCount), c.height/2 - height/2, c.width/rayCount + 1, height);
  }

  // Desk & monitor (overlay)
  ctx.fillStyle = '#442200';
  ctx.fillRect(c.width/2 - 220, c.height - 340, 440, 240);
  ctx.fillStyle = '#00aa88';
  ctx.fillRect(c.width/2 - 200, c.height - 320, 400, 200);

  // Pistol under desk
  if (!pistolEquipped) {
    ctx.fillStyle = '#444466';
    ctx.fillRect(c.width/2 - 80, c.height - 180, 160, 60);
  }
}

// =============== MOVEMENT ===============
const speed = 5;
function updatePlayer(delta) {
  if (keys['w']) {
    playerX += Math.cos(playerAngle) * speed * delta;
    playerY += Math.sin(playerAngle) * speed * delta;
  }
  if (keys['s']) {
    playerX -= Math.cos(playerAngle) * speed * delta;
    playerY -= Math.sin(playerAngle) * speed * delta;
  }
  if (keys['a']) {
    playerX += Math.cos(playerAngle - Math.PI/2) * speed * delta;
    playerY += Math.sin(playerAngle - Math.PI/2) * speed * delta;
  }
  if (keys['d']) {
    playerX += Math.cos(playerAngle + Math.PI/2) * speed * delta;
    playerY += Math.sin(playerAngle + Math.PI/2) * speed * delta;
  }
}

// =============== GAME LOOP ===============
let lastTime = performance.now();
function animate() {
  const now = performance.now();
  const delta = (now - lastTime) / 1000;
  lastTime = now;

  updatePlayer(delta);
  render();

  requestAnimationFrame(animate);
}
animate();

// =============== TIMER ===============
function updateTimer() {
  if (gameState !== 'shift') return;
  timeLeft--;
  document.getElementById('time').textContent = 
    `${Math.floor(timeLeft/60).toString().padStart(2,'0')}:${(timeLeft%60).toString().padStart(2,'0')}`;

  if (timeLeft <= 0) {
    gameState = 'end-shift';
    document.getElementById('end-shift').style.display = 'block';
    setTimeout(() => {
      gameState = 'driving';
      document.getElementById('end-shift').style.display = 'none';
      startDriving();
    }, 6000);
  }
}
setInterval(updateTimer, 1000);

// =============== DRIVING PHASE ===============
function startDriving() {
  let t = 0;
  const drive = setInterval(() => {
    t += 0.1;
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,c.width,c.height);
    ctx.fillStyle = '#111';
    ctx.fillRect(0, c.height/2 - 120, c.width, 240);
    if (Math.random() < 0.4) {
      ctx.fillStyle = '#ff0040';
      ctx.fillRect(Math.random()*c.width, c.height/2 - 60, 40, 120);
    }
    if (t > 12) {
      clearInterval(drive);
      shift++;
      if (shift > 10) {
        shift = 1;
        localStorage.removeItem('currentShift');
      } else {
        localStorage.setItem('currentShift', shift);
      }
      timeLeft = 240;
      updateMissionText();
      gameState = 'shift';
    }
  }, 100);
}
</script>
</body>
</html>
