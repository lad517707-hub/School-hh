<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dropzone Protocol</title>
<style>
html,body{margin:0;overflow:hidden;background:#1a1a1a;font-family:monospace}
canvas{image-rendering:pixelated;display:block}
#ui{
 position:fixed;inset:0;color:white;pointer-events:none
}
button,input{
 pointer-events:auto;
 background:#222;color:#fff;border:1px solid #555;
 padding:8px;margin:4px
}
.panel{
 background:#111;border:1px solid #555;padding:10px
}
</style>
</head>
<body>

<div id="ui">
 <div id="menu" class="panel">
  <h2>DROPZONE PROTOCOL</h2>
  <input id="name" placeholder="Username"><br>
  <button onclick="startSingle()">Single Player</button>
  <button onclick="openMulti()">Multiplayer</button>
 </div>

 <div id="multi" class="panel" style="display:none">
  <input id="party" placeholder="Party Name">
  <input id="code" placeholder="Join Code">
  <button onclick="createParty()">Create</button>
  <button onclick="joinParty()">Join</button>
 </div>

 <div id="hud" style="display:none">
  <div id="hp"></div>
  <div id="kills"></div>
  <div id="timer"></div>
 </div>
</div>

<canvas id="c"></canvas>

<script>
/* ================= SETUP ================= */
const c=document.getElementById("c"),ctx=c.getContext("2d");
function resize(){c.width=innerWidth;c.height=innerHeight}
resize();addEventListener("resize",resize);

let game=false;
let extractionTimer=300;
let ship=null;

/* ================= INPUT ================= */
const keys={},mouse={x:0,y:0,down:false};
onkeydown=e=>keys[e.key]=true;
onkeyup=e=>keys[e.key]=false;
onmousemove=e=>{mouse.x=e.clientX;mouse.y=e.clientY};
onmousedown=()=>mouse.down=true;
onmouseup=()=>mouse.down=false;

/* ================= PLAYER ================= */
const player={
 x:0,y:0,hp:100,max:100,kills:0,
 gun:"rifle"
};

/* ================= ENEMIES ================= */
const enemies=[];
function spawnEnemy(){
 enemies.push({
  x:(Math.random()-0.5)*1000,
  y:(Math.random()-0.5)*1000,
  hp:40,
  target:"player"
 });
}

/* ================= SHIP ================= */
function spawnShip(){
 ship={
  x:player.x,y:player.y,
  hp:player.max*10,
  timer:10
 };
 enemies.forEach(e=>e.target="ship");
}

/* ================= BULLETS ================= */
const bullets=[];
function shoot(){
 let spread=player.gun==="shotgun"?5:1;
 for(let i=0;i<spread;i++){
  bullets.push({
   x:player.x,y:player.y,
   dx:Math.cos(player.angle)+(Math.random()-0.5)*0.2,
   dy:Math.sin(player.angle)+(Math.random()-0.5)*0.2,
   dmg:player.gun==="heavy"?30:10,
   life:40
  });
 }
}

/* ================= UPDATE ================= */
function update(){
 if(!game)return;

 if(keys.w)player.y-=3;
 if(keys.s)player.y+=3;
 if(keys.a)player.x-=3;
 if(keys.d)player.x+=3;

 player.angle=Math.atan2(mouse.y-c.height/2,mouse.x-c.width/2);

 if(mouse.down)shoot();

 bullets.forEach(b=>{
  b.x+=b.dx*8;b.y+=b.dy*8;b.life--;
  enemies.forEach(e=>{
   if(Math.hypot(b.x-e.x,b.y-e.y)<12){
    e.hp-=b.dmg;b.life=0;
    if(e.hp<=0)player.kills++;
   }
  });
 });

 for(let i=bullets.length-1;i>=0;i--)
  if(bullets[i].life<=0)bullets.splice(i,1);

 enemies.forEach(e=>{
  let t=e.target==="ship"&&ship?ship:player;
  let dx=t.x-e.x,dy=t.y-e.y,d=Math.hypot(dx,dy);
  e.x+=dx/d*1.2;e.y+=dy/d*1.2;
  if(d<16){
   if(t===player)player.hp-=0.2;
   else ship.hp-=0.3;
  }
 });

 if(Math.random()<0.03)spawnEnemy();

 extractionTimer-=1/60;
 if(extractionTimer<=0&&!ship)spawnShip();
 if(ship){
  ship.timer-=1/60;
  if(ship.hp<=0)end("MISSION FAILED");
  if(ship.timer<=0)end("EXTRACTED");
 }
}

/* ================= DRAW ================= */
function draw(){
 ctx.clearRect(0,0,c.width,c.height);
 ctx.translate(c.width/2-player.x,c.height/2-player.y);

 // ground
 ctx.fillStyle="#2c2c2c";
 ctx.fillRect(player.x-2000,player.y-2000,4000,4000);

 // enemies
 enemies.forEach(e=>{
  ctx.fillStyle="#300";
  ctx.beginPath();
  ctx.ellipse(e.x,e.y,10,14,0,0,Math.PI*2);
  ctx.fill();
 });

 // bullets
 ctx.fillStyle="#ff0";
 bullets.forEach(b=>ctx.fillRect(b.x,b.y,3,2));

 // ship
 if(ship){
  ctx.fillStyle="#666";
  ctx.fillRect(ship.x-20,ship.y-20,40,40);
 }

 // player
 ctx.save();
 ctx.translate(player.x,player.y);
 ctx.rotate(player.angle);
 ctx.fillStyle="#ccc";
 ctx.fillRect(-6,-6,12,12);
 ctx.fillRect(0,-2,14,4);
 ctx.restore();

 ctx.setTransform(1,0,0,1,0,0);

 document.getElementById("hp").innerText=`HP: ${Math.max(0,player.hp|0)}`;
 document.getElementById("kills").innerText=`Kills: ${player.kills}`;
 document.getElementById("timer").innerText=
  ship?`Ship HP: ${ship.hp|0}`:`Extraction in ${extractionTimer|0}`;
}

/* ================= LOOP ================= */
function loop(){update();draw();requestAnimationFrame(loop)}loop();

/* ================= UI ================= */
function startSingle(){
 game=true;
 document.getElementById("menu").style.display="none";
 document.getElementById("hud").style.display="block";
}

function openMulti(){
 document.getElementById("menu").style.display="none";
 document.getElementById("multi").style.display="block";
}

function createParty(){startSingle()}
function joinParty(){startSingle()}

function end(text){
 alert(text);
 location.reload();
}
</script>
</body>
</html>
