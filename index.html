<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legion Survival â€“ Ruined Outpost</title>
<style>
    body { margin:0; padding:0; background:#000; color:#eee; font-family:Arial, sans-serif; overflow:hidden; }
    #ui { position:absolute; top:15px; left:15px; background:rgba(10,10,30,0.85); padding:20px; border:1px solid #444; border-radius:10px; z-index:10; max-width:340px; }
    #canvas { display:block; cursor:crosshair; image-rendering:pixelated; }
    button, select { padding:10px 16px; margin:8px 6px 8px 0; font-size:15px; background:#1a1a3a; color:#eee; border:1px solid #555; border-radius:6px; cursor:pointer; }
    button:hover { background:#2a2a5a; }
    #story { position:absolute; inset:0; background:rgba(0,0,20,0.92); z-index:20; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:50px; text-align:center; font-size:19px; line-height:1.6; }
    #story button { font-size:22px; padding:15px 40px; margin-top:40px; }
    #objective { position:absolute; bottom:20px; left:20px; background:rgba(0,0,0,0.7); padding:12px 20px; border-radius:8px; font-size:16px; max-width:600px; z-index:5; display:none; }
    #endScreen { position:absolute; inset:0; background:rgba(0,0,20,0.92); z-index:20; display:none; flex-direction:column; justify-content:center; align-items:center; padding:50px; text-align:center; font-size:28px; line-height:1.6; }
</style>
</head>
<body>

<div id="story">
    <h1>Abandoned Outpost â€“ Forgotten World</h1>
    <p>Your squad awakens in the ruins... Warp horrors everywhere.<br>
    Lead your battle-brothers to the machine and activate the beam.</p>
    <button onclick="document.getElementById('story').style.display='none'">Begin</button>
</div>

<div id="ui">
    <label><strong>Choose your Legion:</strong></label><br>
    <select id="legionSelect">
        <option value="">â€” Select Legion â€”</option>
        <option value="Dark Angels">Dark Angels</option>
        <option value="Emperor's Children">Emperor's Children</option>
        <option value="Iron Warriors">Iron Warriors</option>
        <option value="White Scars">White Scars</option>
        <option value="Space Wolves">Space Wolves</option>
        <option value="Imperial Fists">Imperial Fists</option>
        <option value="Night Lords">Night Lords</option>
        <option value="Blood Angels">Blood Angels</option>
        <option value="Iron Hands">Iron Hands</option>
        <option value="World Eaters">World Eaters</option>
        <option value="Ultramarines">Ultramarines</option>
        <option value="Death Guard">Death Guard</option>
        <option value="Thousand Sons">Thousand Sons</option>
        <option value="Sons of Horus">Sons of Horus</option>
        <option value="Word Bearers">Word Bearers</option>
        <option value="Salamanders">Salamanders</option>
        <option value="Raven Guard">Raven Guard</option>
        <option value="Alpha Legion">Alpha Legion</option>
    </select><br>
    <button onclick="startCampaign()">Deploy</button>
</div>

<canvas id="canvas" width="1400" height="900"></canvas>

<div id="objective">Click marine to select â†’ click to move.<br>Leader makes squad follow.<br>Mouse wheel = zoom (details!).</div>

<div id="endScreen">
    <h1>Victory!</h1>
    <p>Beam activated. Glory to the Legion.</p>
    <button onclick="location.reload()">Restart</button>
</div>

<script>
// ... (keep most of the previous code structure, only changing drawUnits and related)

const LEGION_DETAILS = {
    "Dark Angels": {main: "#2e7d32", accent: "#1b5e20", symbol: "sword", pad: "wing"},
    "Emperor's Children": {main: "#7b1fa2", accent: "#d500f9", symbol: "eagle", pad: "gem"},
    "Iron Warriors": {main: "#616161", accent: "#424242", symbol: "skull", pad: "hazard"},
    "White Scars": {main: "#e0e0e0", accent: "#ffffff", symbol: "lightning", pad: "scar"},
    "Space Wolves": {main: "#90caf9", accent: "#bbdefb", symbol: "wolf", pad: "pelt"},
    "Imperial Fists": {main: "#ffeb3b", accent: "#fdd835", symbol: "fist", pad: "castle"},
    "Night Lords": {main: "#0d47a1", accent: "#1565c0", symbol: "bat", pad: "wingdark"},
    "Blood Angels": {main: "#c62828", accent: "#b71c1c", symbol: "drop", pad: "blood"},
    "Iron Hands": {main: "#212121", accent: "#424242", symbol: "hand", pad: "metal"},
    "World Eaters": {main: "#b71c1c", accent: "#d32f2f", symbol: "axe", pad: "chain"},
    "Ultramarines": {main: "#1976d2", accent: "#1565c0", symbol: "U", pad: "laurel"},
    "Death Guard": {main: "#558b2f", accent: "#33691e", symbol: "fly", pad: "rot"},
    "Thousand Sons": {main: "#283593", accent: "#4527a0", symbol: "eye", pad: "rune"},
    "Sons of Horus": {main: "#2e7d32", accent: "#1b5e20", symbol: "eye", pad: "lupercal"},
    "Word Bearers": {main: "#880e4f", accent: "#ad1457", symbol: "book", pad: "cog"},
    "Salamanders": {main: "#1b5e20", accent: "#2e7d32", symbol: "flame", pad: "drake"},
    "Raven Guard": {main: "#263238", accent: "#37474f", symbol: "raven", pad: "claw"},
    "Alpha Legion": {main: "#00695c", accent: "#004d40", symbol: "hydra", pad: "scale"}
};

function drawLegionnaire(x, y, color, details, size = 11, isLeader = false, zoomLevel) {
    const s = size * (isLeader ? 1.4 : 1);

    // Base body
    ctx.fillStyle = details.main;
    ctx.beginPath();
    ctx.arc(x, y, s, 0, Math.PI*2);
    ctx.fill();

    // Helmet
    ctx.fillStyle = details.accent || details.main;
    ctx.beginPath();
    ctx.arc(x, y - s*0.6, s*0.5, 0, Math.PI*2);
    ctx.fill();

    // Shoulder pads
    ctx.fillStyle = details.accent;
    ctx.beginPath();
    ctx.arc(x - s*0.8, y - s*0.3, s*0.6, 0, Math.PI*2);
    ctx.arc(x + s*0.8, y - s*0.3, s*0.6, 0, Math.PI*2);
    ctx.fill();

    // Legion symbol approximation
    if (zoomLevel > 1.5) {
        ctx.fillStyle = "#ffffff88";
        ctx.font = `${s*0.8}px Arial`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        let sym = "?";
        switch(details.symbol) {
            case "sword": sym = "â€ "; break;
            case "eagle": sym = "ðŸ¦…"; break;
            case "skull": sym = "â˜ "; break;
            case "lightning": sym = "âš¡"; break;
            case "wolf": sym = "ðŸº"; break;
            case "fist": sym = "âœŠ"; break;
            case "bat": sym = "ðŸ¦‡"; break;
            case "drop": sym = "ðŸ’§"; break;
            case "hand": sym = "ðŸ¤–"; break;
            case "axe": sym = "ðŸª“"; break;
            case "U": sym = "U"; break;
            case "fly": sym = "ðŸª°"; break;
            case "eye": sym = "ðŸ‘"; break;
            case "book": sym = "ðŸ“–"; break;
            case "flame": sym = "ðŸ”¥"; break;
            case "raven": sym = "ðŸ¦…"; break;
            case "hydra": sym = "ðŸ‰"; break;
        }
        ctx.fillText(sym, x, y - s*0.3);
    }

    // Extra leader flair
    if (isLeader) {
        ctx.strokeStyle = "#ffff99";
        ctx.lineWidth = 3 / zoomLevel;
        ctx.beginPath();
        ctx.arc(x, y, s*1.3, 0, Math.PI*2);
        ctx.stroke();
    }
}

function drawUnits() {
    // ... shadows etc. as before

    playerUnits.forEach((u, i) => {
        if (u.hp <= 0) return;
        const details = LEGION_DETAILS[playerLegionName] || {main: playerColor, accent: playerColor, symbol: "?"};
        drawLegionnaire(u.x, u.y, playerColor, details, 11, u.isLeader, zoom);

        // ... selection ring, scratches, etc. as before
    });
}

// In startCampaign, set playerLegionName = document.getElementById('legionSelect').value;

let playerLegionName = "";

// ... rest of code remains similar, just replace circle draws with drawLegionnaire calls
</script>
</body>
</html>
