<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Shift Horror - 10 Nights</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<style>
  body, html { margin:0; padding:0; overflow:hidden; background:#000; font-family:'Courier New', monospace; color:#0f0; image-rendering:pixelated; }
  canvas { position:absolute; inset:0; image-rendering:pixelated; }
  #ui { position:absolute; inset:0; pointer-events:none; color:#0f0; text-shadow:0 0 6px #0f0; font-size:1.3rem; padding:20px; }
  #phone {
    position:absolute; bottom:30px; left:50%; transform:translateX(-50%);
    width:340px; height:680px; background:#111; border:6px solid #222; border-radius:32px;
    padding:24px; box-shadow:0 0 40px #000; display:none; pointer-events:all; overflow-y:auto; font-size:1.1rem; line-height:1.5;
  }
  #phone.show { display:block; }
  #time { position:absolute; top:20px; right:30px; font-size:2.8rem; text-shadow:0 0 10px #0f0; }
  #shift-message { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:4rem; text-align:center; color:#f00; text-shadow:0 0 16px #f00; display:none; }
  #end-shift { position:absolute; inset:0; background:rgba(0,0,0,0.95); color:#f00; font-size:5rem; text-align:center; padding-top:40vh; display:none; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
  <div id="time">04:00</div>
</div>

<div id="phone">
  <h2>Phone</h2>
  <div id="mission-text"></div>
</div>

<div id="shift-message"></div>
<div id="end-shift">YOUR SHIFT IS OVER<br>GO HOME</div>

<script>
// =============== CONFIG ===============
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let shift = parseInt(localStorage.getItem('currentShift') || '1');
let timeLeft = 240; // 4 minutes
let gameState = 'shift'; // shift / end-shift / driving / next-shift
let childrenQueue = [];
let rooms = Array(18).fill(0); // 0-17 rooms, max 20 kids each

const missions = [
  "", // index 0 unused
  "Get all the children into their corresponding Class room",
  "Get all the children into their corresponding class room...",
  "children in classroom",
  "classroom",
  "children",
  "I see you...",
  "",
  "I know who you are... and i'm not afraid...",
  "aoidhfa;fhoapdifhvnaosd;pfui",
  "In a next life, i"
];

// =============== INPUT ===============
const keys = {};
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// Phone toggle
let phoneOpen = false;
document.addEventListener('keydown', e => {
  if (e.key === 'Shift') {
    phoneOpen = !phoneOpen;
    document.getElementById('phone').classList.toggle('show', phoneOpen);
  }
});

// =============== TIMER & SHIFT LOGIC ===============
function updateTimer() {
  if (gameState !== 'shift') return;
  timeLeft--;
  document.getElementById('time').textContent = 
    `${Math.floor(timeLeft/60).toString().padStart(2,'0')}:${(timeLeft%60).toString().padStart(2,'0')}`;

  if (timeLeft <= 0) {
    gameState = 'end-shift';
    document.getElementById('end-shift').style.display = 'block';
    setTimeout(() => {
      gameState = 'driving';
      document.getElementById('end-shift').style.display = 'none';
      startDrivingPhase();
    }, 6000);
  }
}
setInterval(updateTimer, 1000);

// =============== MISSION TEXT ===============
function updateMissionText() {
  const text = missions[shift] || "No mission defined for this shift.";
  document.getElementById('mission-text').innerHTML = `<strong>Night ${shift} Mission:</strong><br><br>${text}`;
}
updateMissionText();

// =============== SIMPLE FIRST-PERSON RENDER ===============
let playerAngle = 0;

function renderScene() {
  ctx.fillStyle = '#0a0a0a';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Floor & ceiling
  ctx.fillStyle = '#111';
  ctx.fillRect(0, canvas.height/2, canvas.width, canvas.height/2);
  ctx.fillStyle = '#222';
  ctx.fillRect(0, 0, canvas.width, canvas.height/2);

  // Fake walls / hallway
  for (let i = 0; i < 80; i++) {
    const angle = playerAngle + (i/80 - 0.5) * 1.2;
    const dist = 8 + Math.sin(angle * 6 + Date.now()*0.0008)*1.5;
    const height = canvas.height / dist * 60;
    ctx.fillStyle = i%2===0 ? '#003300' : '#002200';
    ctx.fillRect(i*(canvas.width/80), canvas.height/2 - height/2, canvas.width/80 + 1, height);
  }

  // Desk & monitor
  ctx.fillStyle = '#1a1a1a';
  ctx.fillRect(canvas.width/2 - 220, canvas.height - 340, 440, 240);
  ctx.fillStyle = '#00aa22';
  ctx.fillRect(canvas.width/2 - 200, canvas.height - 320, 400, 200);
}

// =============== CHILDREN / MONSTERS ===============
function spawnEntity() {
  const isMonster = Math.random() < (shift/12); // chance increases with shift
  const entity = {
    name: isMonster ? '???' : `Child ${Math.floor(Math.random()*200)}`,
    room: Math.floor(Math.random()*18),
    isMonster
  };
  childrenQueue.push(entity);
  addChatMsg(`A ${entity.name} wants room ${entity.room + 1}`);
}

function addChatMsg(msg) {
  const div = document.createElement('div');
  div.textContent = msg;
  div.style.margin = '8px 0';
  document.getElementById('chat')?.appendChild(div) || console.log(msg);
}

// =============== GAME LOOP ===============
function gameLoop() {
  renderScene();

  // Spawn entities
  if (Math.random() < 0.025) spawnEntity();

  // E to grab rifle / shoot
  if (keys['e']) {
    addChatMsg("Rifle grabbed. Aim carefully...");
    keys['e'] = false;
  }

  requestAnimationFrame(gameLoop);
}

gameLoop();

// =============== DRIVING PHASE (simple) ===============
function startDrivingPhase() {
  addChatMsg("Driving home...");

  let t = 0;
  const drive = setInterval(() => {
    t += 0.1;
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Road
    ctx.fillStyle = '#222';
    ctx.fillRect(0, canvas.height/2 - 120, canvas.width, 240);

    // Disturbing creatures
    if (Math.random() < 0.15) {
      addChatMsg("Something moved in the shadows...");
    }

    if (t > 12) {
      clearInterval(drive);
      shift++;
      if (shift > 10) {
        addChatMsg("All shifts complete. The nightmare is over... or is it?");
        localStorage.removeItem('currentShift');
      } else {
        localStorage.setItem('currentShift', shift);
        timeLeft = 240;
        updateMissionText();
        gameState = 'shift';
      }
    }
  }, 100);
}
</script>
</body>
</html>
